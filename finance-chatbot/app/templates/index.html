<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>üîç Finance Chatbot</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; background-color: #1a1a1a; color: white; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin-bottom: 2rem; padding: 1.5rem; background-color: #2d2d2d; border-radius: 10px; }
        .company-selector { margin-bottom: 1rem; }
        select { width: 100%; padding: 0.75rem; font-size: 1rem; background-color: #404040; color: white; border: 1px solid #555; border-radius: 5px; }
        .index-btn { padding: 0.75rem 1.5rem; background-color: #007acc; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; }
        .index-btn:hover { background-color: #005a9e; }
        .chat-container { margin-top: 2rem; }
        .message { margin-bottom: 1rem; padding: 1rem; border-radius: 10px; }
        .user { background-color: #2d5a8b; text-align: right; }
        .assistant { background-color: #404040; text-align: left; }
        textarea { width: 100%; height: 3rem; padding: 0.75rem; font-size: 1rem; background-color: #404040; color: white; border: 1px solid #555; border-radius: 5px; }
        .send-btn { padding: 0.75rem 1.5rem; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; margin-top: 0.5rem; }
        .send-btn:hover { background-color: #1e7e34; }
        .clear-btn { padding: 0.5rem 1rem; background-color: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 1rem; }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
        .status { margin-top: 1rem; padding: 0.5rem; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ÔøΩÔøΩ AI Finance Chatbot</h1>

        <!-- Step 1: Select and Index Company Documents -->
        <div class="section">
            <h2>üìä Step 1: Select Company Documents</h2>
            <form method="post" action="{{ url_for('index_documents') }}">
                <div class="company-selector">
                    <label for="company">Choose a company:</label>
                    <select name="company" id="company" required>
                        <option value="">Select a company...</option>
                        <option value="NASDAQ_AAPL_2024">Apple Inc. (AAPL)</option>
                        <option value="NASDAQ_MSFT_2024">Microsoft Corporation (MSFT)</option>
                        <option value="NASDAQ_AMZN_2024">Amazon.com Inc. (AMZN)</option>
                        <option value="NASDAQ_META_2024">Meta Platforms Inc. (META)</option>
                        <option value="NASDAQ_NVDA_2024">NVIDIA Corporation (NVDA)</option>
                    </select>
                </div>
                <button type="submit" class="index-btn">üìö Index Company Documents</button>
            </form>
            
            {% if indexing_status %}
                <div class="status {% if indexing_status.success %}success{% else %}error{% endif %}">
                    {{ indexing_status.message }}
                </div>
            {% endif %}
        </div>

        <!-- Step 2: Chat Interface -->
        {% if session.get('selected_company') %}
        <div class="section chat-container">
            <h2>üí¨ Step 2: Ask Questions about {{ session.get('selected_company')|title }}</h2>
            
            {% if error %}
                <p class="error">{{ error }}</p>
            {% endif %}

            <div id="chat-box">
                {% for msg in messages %}
                    <div class="message {{ msg.role }}">
                        <strong>{{ msg.role|capitalize }}:</strong><br />
                        {{ msg.content | safe | nl2br }}
                    </div>
                {% endfor %}
            </div>

            <form method="post" action="{{ url_for('chat') }}">
                <textarea name="prompt" placeholder="Ask a question about {{ session.get('selected_company')|title }}'s financial data..." required></textarea>
                <br />
                <button type="submit" class="send-btn">Send Question</button>
            </form>

            <form method="get" action="{{ url_for('clear') }}">
                <button type="submit" class="clear-btn">Clear Chat</button>
            </form>
        </div>
        {% endif %}
    </div>
</body>
</html>